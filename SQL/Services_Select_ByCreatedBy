ALTER PROC [dbo].[Services_Select_ByCreatedBy] @PageSize int
											   ,@PageIndex int
											   ,@UserId int
as

/* ----- Test Code -----

Declare @PageSize int = 5
	   ,@PageIndex int = 0
	   ,@UserId int = 30

EXECUTE [dbo].[Services_Select_ByCreatedBy] @PageSize
										   ,@PageIndex
										   ,@UserId

*/

BEGIN

	DECLARE @Offset int = @PageSize * @PageIndex

	SELECT s.[Id]
		  ,st.[Name] as ServiceType
		  ,s.[Name]
		  ,s.[Description]
		  ,s.[Total]
		  ,s.[ServiceCode]
		  ,s.[IsActive]
		  ,s.[DateCreated]
		  ,s.[DateModified]
		  ,u.[Id] as UserId 
		  ,s.[ModifiedBy]
		  ,TotalCount = COUNT(1)OVER()

	FROM [dbo].[Services] as s inner join [dbo].[ServiceTypes] as st
					      on [s].[ServiceTypeId] = [st].[Id]
						  inner join [dbo].[Users] as u
						  on s.CreatedBy = u.Id
	WHERE [s].[CreatedBy] = @UserId
	ORDER BY UserId

	OFFSET @Offset ROWS 
	FETCH NEXT @PageSize ROWS ONLY

END
